Template Creation Guide
=======================

> *git-xflow* uses templates to generate files or execute commands when making
> patches or reviews. This way, you are able to configure *git-xflow* to fit
> exactly your needs, and, by following this guide, to extend its possibilities.



When templates are used?
------------------------

Templates are used when thse *git-xflow* commands are executed:

* Patches:
  * `git xflow patch make FROM..TO`
  * `git xflow patch tags FROM..TO`
  * `git xflow SUBCOMMAND patch NAME`
* Reviews:
  * `git xflow SUBCOMMAND review NAME`



How to configure used templates?
--------------------------------

There are two ways to configure templates used by *git-xflow*:

* Once for the repository, by typing command: `git xflow init`
* Only for the current command, by appending to it option `t`: `-t TEMPLATE`



Where to place templates?
-------------------------

*git-xflow* looks for templates only in following folders, by order of priority:

1. Absolute or relative path (from current working directory): `TEMPLATE`
2. `.git/git-xflow/templates/COMMAND/TEMPLATE`, where COMMAND is `patch` or `review`
3. Search for `TEMPLATE` relative to root path of current git repository
4. `GIT_XFLOW_INSTALL/templates/COMMAND/TEMPLATE`, where GIT_XFLOW_INSTALL is
   this *git-xflow* installation directory, and COMMAND is `patch` or `review`



How to write a template?
------------------------

When *git-xflow* uses a template, it creates a new file with all content of the
used template. Of course, it is possible to add dynamic content to the output.

To achieve that, *git-xflow* interprets several tags:



### Comment tags

> Write comments in your template.
>
> Comments won't be writen in output file,
> and all other tags contained in them won't be interpreted.

Opening tag: `<%#`

Closing tag: `%#>`

Example:

```
<%#
    A sample comment ...
    The following tag is commented, so it won't be executed:
    <% echo test %>
%#>
```



### Variable tags

> Write the content of a variable directly in-place in the output file.

Opening tag: `<%=`

Closing tag: `%>`

Example:

```sh
############## Installer configuration ##############

readonly PATCH_NAME="<%= patch_name %>"
readonly PATCH_DIFF="<%= patch_diff %>"
readonly GITXFLOW_VERSION="<%= GITXFLOW_VERSION %>"
```



### Not echoed command tags

> Execute *bash* commands that won't be writen in the output file.
>
> Usefull for variable affectation.

Opening tag: `<%@`

Closing tag: `%>`

Example:

```
<%@ generated_file_suffix=".myextension" %>
```



### Echoed command tags

> Execute *bash* commands that will be writen in-place in the output file.

Opening tag: `<%$`

Closing tag: `%>`

Example:

```sh
# Delete removed files
<%$
    echo "${patch_diff}" | grep ^D | cut -f2 | sed 's/.*/Remove-Item &/g'
%>
```



### To-file command tags

> Execute *bash* commands that will be writen directly to the output file.
>
> Usefull for writing binary content (such as zip ...).

Opening tag: `<%:`

Closing tag: `%>`

Example:

```sh
<%:
    git archive --format=zip -9 ${patch_to} $(echo "${patch_diff}" | awk '{ if [[ $1 != "D" ]] printf("\"%s\"\n", substr($0,3)) }')
%>
```



Available variables in templates
--------------------------------

> In templates, some variable are exposed by *git-xflow*, and can so be used.

* Common variables:
  * `GITXFLOW_VERSION`: version of *git-xflow* installed and running
  * `GITXFLOW_DIR`: installation directory of *git-xflow*
  * `DOT_GIT_DIR`: *.git* directory of current git repository
  * `template_list`: list of used templates for this command
  * `template`: name of currently used template
  * `template_file`: filename of the currently used template
  * `generated_file_name`: basename of the file to be generated by the template
    * *The output file name will be a concatenation of `generated_file_name` and `generated_file_suffix`*
  * `generated_file_suffix`: suffix of the file to be generated by the template
    * *The output file name will be a concatenation of `generated_file_name` and `generated_file_suffix`*
  * `parsed_template`: the content of the actually parsed template, to be writen in the output file
* Patch template variables:
  * `patch_from`: patch is made from this branch/tag/commit
  * `patch_to`: patch is made to this branch/tag/commit
  * `patch_mode`: patch mode, `..` or `...`
  * `patch_diff`: file differences
  * `patch_name`: name of the patch
* Review template variables:
  * `review_from`: review is made from this branch/tag/commit
  * `review_to`: review is made to this branch/tag/commit
  * `review_repository`: the reviewed git repository
  * `review_code_diff`: code differences, formatted to be used easely by scripts
  * `review_files_diff`: file differences
  * `review_name`: name of the review